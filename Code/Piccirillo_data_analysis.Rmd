---
title: "Piccirillo_data_analysis"
author: "lfp"
date: "2025-12-01"
output: html_document
---

```{r}
# Install and load packages
#install.packages("tidyverse")
#install.packages("here")
#install.packages("ggplot2")
#install.packages("lubridate")
#install.packages("sf")
#install.packages("mapview")
#install.packages("leaflet")
#install.packages("corrplot")
library(tidyverse)
library(here)
library(ggplot2)
library(lubridate)
library(sf)
library(mapview)
library(leaflet)
library(corrplot)

# Set your working directory
setwd("~/ENV 872/Final Project/Piccirillo_ENV872_EDA_FinalProject")
getwd()
here()

# Set your ggplot theme
mytheme <- theme_bw() + theme(axis.text = element_text(color = "black"),
                              legend.position = "top",
                              legend.text = element_text(color = "black"))
theme_set(mytheme)

```


```{r}
# uploading dataset
all_data <- read.csv(here("Data/Processed/se_oxygen_processed.csv"),
                     stringsAsFactors = T)

# multiple linear regression model of SELENITE compared to depth & oxygen
# using multiple linear regressions because continuous response/continuous explanatory
selenite_lm <- lm(data = all_data, 
                  Se_IV_D_CONC_BOTTLE ~ depth + meanOxygen)
summary(selenite_lm)

# checking fit of the model
par(mfrow = c(2,2), mar=c(4,4,4,4))
plot(selenite_lm)
par(mfrow = c(1,1))

# correlation plot
selenite_cor <- all_data %>%
  select(Se_IV_D_CONC_BOTTLE, depth, meanOxygen) %>%
  na.omit()

selenite_correlation <- cor(selenite_cor)
corrplot(selenite_correlation, method = 'ellipse')

# plotting the linear regression
ggplot(all_data, aes(depth, Se_IV_D_CONC_BOTTLE)) + 
  geom_point(alpha = 0.7, size = 2.5) +
  labs(x = "Depth (m)", y = "SeIV Concentration (nm/L)", 
       subtitle = "All Locations from GP16 Cruise") + 
  geom_smooth(method = lm, se = F) + 
  ggtitle(label = "Selenite (SeIV) vs. Depth")

# visualizing from oceanography perspective
ggplot(all_data, aes(Se_IV_D_CONC_BOTTLE, depth)) + 
  geom_point(alpha = 0.7, size = 2.5) +
  scale_y_reverse() +
  labs(y = "Depth (m)", x = "SeIV Concentration (nm/L)", 
       subtitle = "All Locations from GP16 Cruise") + 
  geom_smooth(method = lm, se = F) + 
  ggtitle(label = "Selenite (SeIV) vs. Depth")

ggplot(all_data, aes(Se_IV_D_CONC_BOTTLE, meanOxygen)) + 
  geom_point(alpha = 0.7, size = 2.5) +
  scale_y_reverse() +
  labs(y = "Depth (m)", x = "SeIV Concentration (nm/L)", 
       subtitle = "All Locations from GP16 Cruise") + 
  geom_smooth(method = lm, se = F) + 
  ggtitle(label = "Selenite (SeIV) vs. Depth")
```

```{r}
# multiple linear regression model of SELENATE compared to depth
selenate_lm <- lm(data = all_data, 
                  Se_VI_D ~ depth + meanOxygen)
summary(selenate_lm)

# checking fit of model
par(mfrow = c(2,2), mar=c(4,4,4,4))
plot(selenate_lm)
par(mfrow = c(1,1))

# correlation plot
selenite_cor <- all_data %>%
  select(Se_IV_D_CONC_BOTTLE, depth, meanOxygen) %>%
  na.omit()

selenite_correlation <- cor(selenite_cor)
corrplot(selenite_correlation, method = 'ellipse')

ggplot(all_data, aes(Se_VI_D, depth)) + 
  geom_point(alpha = 0.7, size = 2.5) +
  scale_y_reverse(limits = c(6000, 0)) +
  labs(y = "Depth (m)", x = "SeVI Concentration (nm/L)",
       subtitle = "All Locations from GP16 Cruise") + 
  geom_smooth(method = lm, se = F) + 
  ggtitle(label = "Selenate (SeVI) vs. Depth")
```


```{r}
# single linear regression model of organic selenide compared to depth
selenide_lm <- lm(data = all_data, 
                  Org_Se_II_CONC_BOTTLE ~ depth)
summary(selenide_lm)

par(mfrow = c(2,2), mar=c(4,4,4,4))
plot(selenide_lm)
par(mfrow = c(1,1))

ggplot(all_data, aes(Org_Se_II_CONC_BOTTLE, depth)) + 
  geom_point(alpha = 0.7, size = 2.5) +
  scale_y_reverse() + labs(y = "Depth (m)", x = "Se2- Concentration (nm/L)",
                           subtitle = "All Locations from GP16 Cruise") + 
  geom_smooth(method = lm, se = F) + 
  ggtitle(label = "Organic Selenide (Se2-) vs. Depth")
```



```{r}
# pivot longer dataset to plot all Se species together with depth
all_data_gathered <- pivot_longer(all_data, 
                                  Se_IV_D_CONC_BOTTLE:Org_Se_II_CONC_BOTTLE, 
               names_to = "species", values_to = "concentration")

ggplot(all_data_gathered, aes(concentration, depth, colour = species)) + 
  geom_point(alpha = 0.4, size = 2.5) + scale_y_reverse(limits = c(6000, 0)) + 
  geom_smooth(method = lm, se = F, linewidth = 1.8) + 
  labs(y = "Depth (m)", x = "Concentration (nm/L)", 
       color = "Selenium species") + 
  scale_color_viridis_d(labels = c("Organic Selenide", "Selenite", "Selenate"),
                        option = "plasma")
```


```{r}
# is oxygen helping to control organic selenide and maybe the other species too? 
oxygen_only_analysis <- all_data %>%
  filter(!is.na(Sbeox0))
  
# try these as multiple regression: concentration continous response 
oxygen_selenide <- lm(data = oxygen_only_analysis, 
                      Org_Se_II_CONC_BOTTLE ~ Sbeox0)
summary(oxygen_selenide)

ggplot(oxygen_only_analysis, aes(Se_IV_D_CONC_BOTTLE, Sbeox0)) + 
  geom_point()



oxygen_gathered <- pivot_longer(oxygen_only_analysis, 
                                  Se_IV_D_CONC_BOTTLE:Org_Se_II_CONC_BOTTLE, 
               names_to = "species", values_to = "concentration")

ggplot(oxygen_gathered, aes(concentration, Sbeox0, colour = species)) + 
  geom_point() + geom_smooth(method = lm, se = F)
```


```{r}
#OMZ location analysis
OMZ_only <- read.csv(here("Data/Processed/OMZ_data_processed.csv"),
                     stringsAsFactors = T)



ggplot(OMZ_only, aes(Sbeox0, Org_Se_II_CONC_BOTTLE)) + geom_point() + 
  geom_smooth(method = lm, se = F)
```


